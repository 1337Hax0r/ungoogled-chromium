# Building ungoogled-chromium

**Notice for master branch users**: The information in this document may not apply to the latest tag version. Please consult the documentation from the tag instead.

ungoogled-chromium provides scripts to automate the downloading, patching, and building of Chromium with these patches. Here's an overview of the building scripts and files:
* `build-sandbox` - This directory is the build sandbox; the container for all files used and generated during building. It is created when the building environment is setup.
* `build_templates` - This holds the system-dependent files that are used for compiling and generating a binary package. They are copied into the build sandbox by the build setup scripts.
  * `debian` - This contains files to generate a dpkg debian directory. Debian-specific patches are located here.
  * `ubuntu` - This contains files to generate a dpkg debian directory for Ubuntu
* `download_source.sh` - This script downloads the source tarball from `commondatastorage.googleapis.com` and unpacks it into the build sandbox.
  * It accepts arguments; pass in `-h` for more information.
* `generate_domain_substitution_list.sh` - This script generates a list of files containing domain names to be replaced
  * It should be run at the root of the build sandbox.
  * This script is not needed during the normal build process
* `domain_substitution_list` - This file is generated by `generate_domain_substitution_list.sh` for a specific version of Chromium
  * It assumes that the cleaning list has been applied
* `domain_regex_list` - The list of regular expressions used to substitute domain names
* `evaluate_domain_substitution_list.py` - This script evaluates the domain substitution list in the current working directory
* `generate_cleaning_list.sh` - This script generates a file list of mostly all binary files to be stripped from the source tree.
  * It should be run at the root of the build sandbox.
  * This script is not needed during the normal build process
* `cleaning_list` - This file is generated by `generate_cleaning_list.sh` for a specific version of Chromium
* `evaluate_cleaning_list.py` - This script evaluates the cleaning list in the current working directory
* `generate_debian_scripts.sh` - This script creates a dpkg debian directory in the build sandbox for Debian
* `generate_ubuntu_scripts.sh` - This script creates a dpkg debian directory in the build sandbox for Ubuntu
* `build_debian.sh` - This is the main build script for Debian and derivative distributions. It handles the downloading, patching, and building of .deb packages.
  * This script will invoke the other scripts to do certain tasks.
  * It accepts arguments; pass in `-h` for more information.

## Debian and derivatives

Distributions supported: Debian Jessie 64-bit and Stretch 64-bit, and Ubuntu Xenial 64-bit
This may work on other Debian-based distributions and 32-bit systems

**Note for Debian Jessie users**: ungoogled-chromium is configured to build against the system's [FFmpeg](https://www.ffmpeg.org/) (available in Stretch and onwards); [Libav](http://libav.org) (used in Jessie) will not work. However, FFmpeg is available in `jessie-backports`. To install it, add `jessie-backports` to the apt sources, and then install `libavutil-dev`, `libavcodec-dev`, and `libavformat-dev` from it. Note that this will replace Libav.

Run these steps on the system you want to build packages for.

    git clone https://github.com/Eloston/ungoogled-chromium.git
    cd ungoogled-chromium
    git checkout $(git describe --tags `git rev-list --tags --max-count=1`) # Checkout newest tag
    # Run dpkg-checkbuilddeps to find packages needed for building
    ./build_debian.sh -A

Debian packages will appear under `ungoogled-chromium/`

Pass the `-h` flag into `build_debian.sh` or `download_source.sh` for more options.

## Arch Linux

For Arch Linux, consider using [Inox patchset](https://github.com/gcarq/inox-patchset); one of the projects which ungoogled-chromium draws its patches from. It offers pre-built binaries and is also available in AUR.

## Windows

TODO

## Other systems, platforms, and configurations

Please note that building on other platforms and systems is not officially supported, and multiple things can go wrong while attempting to build. Nevertheless, here are some tips: TODO

Consult the build instructions on the [Chromium homepage](http://www.chromium.org/Home) to build Chromium for your system.

The patches in the `patches` directory should work for any build of Chromium. They assume a clean and unmodified Chromium source tree.

These patches are also tested with the GYP flags defined in [`build_templates/debian/rules`](build_templates/debian/rules). Note that enabling some flags, such as `safe_browsing`, may cause the build to fail.

Note about `domain_substitution_list`: Replacing the domains will break URLs in the source tree pointing to Google servers. If your building steps requires additional downloads (such as the the PNaCl toolkit), scripts in the source tree may fail to work.
